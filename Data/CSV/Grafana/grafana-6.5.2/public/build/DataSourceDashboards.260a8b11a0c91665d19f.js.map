{"version":3,"sources":["webpack:///./public/app/features/datasources/DataSourceDashboards.tsx","webpack:///./public/app/features/datasources/state/selectors.ts","webpack:///./public/app/features/datasources/DashboardsTable.tsx"],"names":["DataSourceDashboards","_super","_this","apply","this","arguments","onImport","dashboard","overwrite","_a","props","dataSource","importDashboard","data","pluginId","path","inputs","push","name","type","value","title","onRemove","removeDashboard","importedUri","Object","tslib__WEBPACK_IMPORTED_MODULE_0__","prototype","componentDidMount","loadDataSource","pageId","_b","sent","loadPluginDashboards","render","dashboards","navModel","isLoading","react__WEBPACK_IMPORTED_MODULE_1___default","a","createElement","app_core_components_Page_Page__WEBPACK_IMPORTED_MODULE_4__","Contents","_DashboardsTable__WEBPACK_IMPORTED_MODULE_5__","react__WEBPACK_IMPORTED_MODULE_1__","mapDispatchToProps","_dashboard_state_actions__WEBPACK_IMPORTED_MODULE_10__","_state_actions__WEBPACK_IMPORTED_MODULE_8__","_plugins_state_actions__WEBPACK_IMPORTED_MODULE_9__","__webpack_exports__","react_hot_loader__WEBPACK_IMPORTED_MODULE_2__","module","react_redux__WEBPACK_IMPORTED_MODULE_3__","state","app_core_selectors_location__WEBPACK_IMPORTED_MODULE_7__","location","app_core_selectors_navModel__WEBPACK_IMPORTED_MODULE_6__","navIndex","plugins","_state_selectors__WEBPACK_IMPORTED_MODULE_11__","dataSources","isLoadingPluginDashboards","__webpack_require__","d","getDataSources","getDataSourceTypes","getDataSource","getDataSourceMeta","getDataSourcesSearchQuery","getDataSourcesLayoutMode","getDataSourcesCount","regex","RegExp","searchQuery","filter","test","database","dataSourceTypeSearchQuery","dataSourceTypes","dataSourceId","id","parseInt","dataSourceMeta","layoutMode","dataSourcesCount","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","n","className","map","index","key","dashboardId","imported","href","importedUrl","style","textAlign","onClick","revision","importedRevision","buttonText"],"mappings":"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","file":"DataSourceDashboards.260a8b11a0c91665d19f.js","sourcesContent":["// Libraries\nimport React, { PureComponent } from 'react';\nimport { hot } from 'react-hot-loader';\nimport { connect } from 'react-redux';\n\n// Components\nimport Page from 'app/core/components/Page/Page';\nimport DashboardTable from './DashboardsTable';\n\n// Actions & Selectors\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport { getRouteParamsId } from 'app/core/selectors/location';\nimport { loadDataSource } from './state/actions';\nimport { loadPluginDashboards } from '../plugins/state/actions';\nimport { importDashboard, removeDashboard } from '../dashboard/state/actions';\nimport { getDataSource } from './state/selectors';\n\n// Types\nimport { PluginDashboard, StoreState } from 'app/types';\nimport { DataSourceSettings } from '@grafana/data';\nimport { NavModel } from '@grafana/data';\n\nexport interface Props {\n  navModel: NavModel;\n  dashboards: PluginDashboard[];\n  dataSource: DataSourceSettings;\n  pageId: number;\n  importDashboard: typeof importDashboard;\n  loadDataSource: typeof loadDataSource;\n  loadPluginDashboards: typeof loadPluginDashboards;\n  removeDashboard: typeof removeDashboard;\n  isLoading: boolean;\n}\n\nexport class DataSourceDashboards extends PureComponent<Props> {\n  async componentDidMount() {\n    const { loadDataSource, pageId } = this.props;\n\n    await loadDataSource(pageId);\n    this.props.loadPluginDashboards();\n  }\n\n  onImport = (dashboard: PluginDashboard, overwrite: boolean) => {\n    const { dataSource, importDashboard } = this.props;\n    const data: any = {\n      pluginId: dashboard.pluginId,\n      path: dashboard.path,\n      overwrite,\n      inputs: [],\n    };\n\n    if (dataSource) {\n      data.inputs.push({\n        name: '*',\n        type: 'datasource',\n        pluginId: dataSource.type,\n        value: dataSource.name,\n      });\n    }\n\n    importDashboard(data, dashboard.title);\n  };\n\n  onRemove = (dashboard: PluginDashboard) => {\n    this.props.removeDashboard(dashboard.importedUri);\n  };\n\n  render() {\n    const { dashboards, navModel, isLoading } = this.props;\n    return (\n      <Page navModel={navModel}>\n        <Page.Contents isLoading={isLoading}>\n          <DashboardTable\n            dashboards={dashboards}\n            onImport={(dashboard, overwrite) => this.onImport(dashboard, overwrite)}\n            onRemove={dashboard => this.onRemove(dashboard)}\n          />\n        </Page.Contents>\n      </Page>\n    );\n  }\n}\n\nfunction mapStateToProps(state: StoreState) {\n  const pageId = getRouteParamsId(state.location);\n  return {\n    navModel: getNavModel(state.navIndex, `datasource-dashboards-${pageId}`),\n    pageId: pageId,\n    dashboards: state.plugins.dashboards,\n    dataSource: getDataSource(state.dataSources, pageId),\n    isLoading: state.plugins.isLoadingPluginDashboards,\n  };\n}\n\nconst mapDispatchToProps = {\n  importDashboard,\n  loadDataSource,\n  loadPluginDashboards,\n  removeDashboard,\n};\n\nexport default hot(module)(\n  connect(\n    mapStateToProps,\n    mapDispatchToProps\n  )(DataSourceDashboards)\n);\n","import { DataSourceSettings, DataSourcePluginMeta } from '@grafana/data';\nimport { DataSourcesState } from '../../../types/datasources';\nimport { UrlQueryValue } from '@grafana/runtime';\n\nexport const getDataSources = (state: DataSourcesState) => {\n  const regex = new RegExp(state.searchQuery, 'i');\n\n  return state.dataSources.filter((dataSource: DataSourceSettings) => {\n    return regex.test(dataSource.name) || regex.test(dataSource.database);\n  });\n};\n\nexport const getDataSourceTypes = (state: DataSourcesState) => {\n  const regex = new RegExp(state.dataSourceTypeSearchQuery, 'i');\n\n  return state.dataSourceTypes.filter((type: DataSourcePluginMeta) => {\n    return regex.test(type.name);\n  });\n};\n\nexport const getDataSource = (state: DataSourcesState, dataSourceId: UrlQueryValue): DataSourceSettings | null => {\n  if (state.dataSource.id === parseInt(dataSourceId as string, 10)) {\n    return state.dataSource;\n  }\n  return {} as DataSourceSettings;\n};\n\nexport const getDataSourceMeta = (state: DataSourcesState, type: string): DataSourcePluginMeta => {\n  if (state.dataSourceMeta.id === type) {\n    return state.dataSourceMeta;\n  }\n\n  return {} as DataSourcePluginMeta;\n};\n\nexport const getDataSourcesSearchQuery = (state: DataSourcesState) => state.searchQuery;\nexport const getDataSourcesLayoutMode = (state: DataSourcesState) => state.layoutMode;\nexport const getDataSourcesCount = (state: DataSourcesState) => state.dataSourcesCount;\n","import React, { FC } from 'react';\nimport { PluginDashboard } from '../../types';\n\nexport interface Props {\n  dashboards: PluginDashboard[];\n  onImport: (dashboard: PluginDashboard, overwrite: boolean) => void;\n  onRemove: (dashboard: PluginDashboard) => void;\n}\n\nconst DashboardsTable: FC<Props> = ({ dashboards, onImport, onRemove }) => {\n  function buttonText(dashboard: PluginDashboard) {\n    return dashboard.revision !== dashboard.importedRevision ? 'Update' : 'Re-import';\n  }\n\n  return (\n    <table className=\"filter-table\">\n      <tbody>\n        {dashboards.map((dashboard, index) => {\n          return (\n            <tr key={`${dashboard.dashboardId}-${index}`}>\n              <td className=\"width-1\">\n                <i className=\"gicon gicon-dashboard\" />\n              </td>\n              <td>\n                {dashboard.imported ? (\n                  <a href={dashboard.importedUrl}>{dashboard.title}</a>\n                ) : (\n                  <span>{dashboard.title}</span>\n                )}\n              </td>\n              <td style={{ textAlign: 'right' }}>\n                {!dashboard.imported ? (\n                  <button className=\"btn btn-secondary btn-small\" onClick={() => onImport(dashboard, false)}>\n                    Import\n                  </button>\n                ) : (\n                  <button className=\"btn btn-secondary btn-small\" onClick={() => onImport(dashboard, true)}>\n                    {buttonText(dashboard)}\n                  </button>\n                )}\n                {dashboard.imported && (\n                  <button className=\"btn btn-danger btn-small\" onClick={() => onRemove(dashboard)}>\n                    <i className=\"fa fa-trash\" />\n                  </button>\n                )}\n              </td>\n            </tr>\n          );\n        })}\n      </tbody>\n    </table>\n  );\n};\n\nexport default DashboardsTable;\n"],"sourceRoot":""}